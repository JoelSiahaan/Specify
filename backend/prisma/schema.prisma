// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Initial schema - models will be added as features are implemented
// Connection pooling is configured via DATABASE_URL query parameters:
// - connection_limit: Maximum number of connections (default: 10)
// - pool_timeout: Connection timeout in seconds (default: 30)
// Example: postgresql://user:pass@host:5432/db?connection_limit=10&pool_timeout=30

// User model for authentication and authorization
// Requirements: 17.1, 17.4, 17.5, 1.5, 2.1, 2.2
model User {
  id           String   @id @default(uuid()) @db.Uuid
  email        String   @unique
  name         String
  passwordHash String
  role         Role
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  courses     Course[]     @relation("TeacherCourses") // Courses created by this teacher
  enrollments Enrollment[] // Courses enrolled in (for students)

  @@map("users")
}

// User role enum
// Requirements: 1.5 (Each user has exactly one role: Student or Teacher)
enum Role {
  STUDENT
  TEACHER
}

// Course model for course management
// Requirements: 17.1, 17.4, 17.5, 5.1, 5.4, 5.6, 5.7
model Course {
  id          String       @id @default(uuid()) @db.Uuid
  name        String
  description String
  courseCode  String       @unique
  status      CourseStatus @default(ACTIVE)
  teacherId   String       @db.Uuid
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  teacher     User         @relation("TeacherCourses", fields: [teacherId], references: [id], onDelete: Cascade)
  enrollments Enrollment[]

  @@map("courses")
}

// Course status enum
// Requirements: 5.4 (Course lifecycle: Active → Archived → Deleted)
enum CourseStatus {
  ACTIVE
  ARCHIVED
}

// Enrollment model for student course enrollment
// Requirements: 17.1, 17.4, 17.5, 6.1, 6.5, 6.8
model Enrollment {
  id         String   @id @default(uuid()) @db.Uuid
  studentId  String   @db.Uuid
  courseId   String   @db.Uuid
  enrolledAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  student User   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  course  Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Unique constraint: A student can only enroll once per course
  @@unique([studentId, courseId])
  @@map("enrollments")
}
